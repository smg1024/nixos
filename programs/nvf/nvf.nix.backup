{ lib, ... }:
{
  programs.nvf = {
    enable = true;

    settings = {
      vim = {
        viAlias = false;
        vimAlias = true;

        # Color Scheme
        theme = {
          enable = true;
          name = "tokyonight";
          style = "night";
        };

        # Options
        options = {
          cursorlineopt = "line";
          wrap = false;
          cmdheight = 1;
          tabstop = 2;
          shiftwidth = 2;
          autoindent = true;
          termguicolors = true;
          splitbelow = true;
          splitright = true;
        };
        spellcheck = {
          enable = true;
          languages = [ "en" ];
        };
        searchCase = "smart";
        hideSearchHighlight = true;
        undoFile.enable = true;
        clipboard = {
          enable = true;
          registers = "unnamedplus";
          providers = {
            wl-copy.enable = true;
          };
        };

        # Auto-commands
        augroups = [
          {
            enable = true;
            name = "LastCursorGroup";
          }
          {
            enable = true;
            name = "HighlightYank";
          }
        ];
        autocmds = [
          {
            enable = true;
            event = [ "BufReadPost" ];
            desc = "Return to last cursor position";
            group = "LastCursorGroup";
            callback = lib.generators.mkLuaInline ''
              function()
              	local mark = vim.api.nvim_buf_get_mark(0, '"')
              	local line_count = vim.api.nvim_buf_line_count(0)
              	if mark[1] > 0 and mark[1] <= line_count then
              		pcall(vim.api.nvim_win_set_cursor, 0, mark)
              	end
              end
            '';
          }
          {
            enable = true;
            event = [ "TextYankPost" ];
            desc = "Highlight yanks on copy";
            group = "HighlightYank";
            pattern = [ "*" ];
            callback = lib.generators.mkLuaInline ''
              function()
                vim.hl.on_yank({
                  higroup = "IncSearch",
                  timeout = 250,
                })
              end
            '';
          }
        ];

        # Globals
        globals = {
          mapleader = " ";
          maplocalleader = "\\";
        };

        # Language Server Protocols
        lsp = {
          enable = true;
          inlayHints.enable = true;
          lspconfig.enable = true;
          formatOnSave = true;
        };
        languages = {
          # Nix
          nix = {
            enable = true;
            extraDiagnostics = {
              enable = true;
              types = [
                "deadnix"
                "statix"
              ];
            };
            format = {
              enable = true;
              type = [
                "alejandra"
                "nixfmt"
              ];
            };
            lsp = {
              enable = true;
              servers = [ "nil" ];
            };
            treesitter.enable = true;
          };

          # Python
          python = {
            enable = true;
            format = {
              enable = true;
              type = [ "ruff" ];
            };
            lsp = {
              enable = true;
              servers = [ "pyright" ];
            };
            treesitter.enable = true;
          };

          # Lua
          lua = {
            enable = true;
            extraDiagnostics = {
              enable = true;
              types = [ "luacheck" ];
            };
            format = {
              enable = true;
              type = [ "stylua" ];
            };
            lsp = {
              enable = true;
              servers = [ "lua-language-server" ];
            };
            treesitter.enable = true;
          };

          # Bash
          bash = {
            enable = true;
            extraDiagnostics = {
              enable = true;
              types = [ "shellcheck" ];
            };
            format = {
              enable = true;
              type = [ "shfmt" ];
            };
            lsp = {
              enable = true;
              servers = [ "bash-ls" ];
            };
            treesitter.enable = true;
          };

          # Markdown
          markdown = {
            enable = true;
            extensions = {
              render-markdown-nvim = {
                enable = true;
                setupOpts = {
                  checkbox = {
                    checked.scope_highlight = "@markup.strikethrough";
                  };
                };
              };
            };
            extraDiagnostics = {
              enable = true;
              types = [ "markdownlint-cli2" ];
            };
            format = {
              enable = true;
              type = [
                "prettierd"
                "deno_fmt"
              ];
            };
            lsp = {
              enable = true;
              servers = [ "marksman" ];
            };
            treesitter.enable = true;
          };

          # html
          html = {
            enable = true;
            extraDiagnostics = {
              enable = true;
              types = [ "htmlhint" ];
            };
            format = {
              enable = true;
              type = [
                "superhtml"
                "prettierd"
              ];
            };
            lsp = {
              enable = true;
              servers = [ "superhtml" ];
            };
            treesitter = {
              enable = true;
              autotagHtml = true;
            };
          };

          # yaml
          yaml = {
            enable = true;
            lsp = {
              enable = true;
              servers = [ "yaml-language-server" ];
            };
            treesitter.enable = true;
          };
        };

        # Autocomplete
        autocomplete = {
          blink-cmp = {
            enable = true;
            friendly-snippets.enable = true;
            setupOpts = {
              keymap.preset = "default";
              cmdline = {
                keymap.preset = "default";
              };
              completion = {
                documentation = {
                  auto_show = true;
                  auto_show_delay_ms = 1000;
                };
              };
            };
            sourcePlugins = {
              emoji.enable = true;
            };
          };
        };

        # fzf-lua
        fzf-lua = {
          enable = true;
          profile = "default";
          setupOpts = {
          };
        };

        # Status Line
        mini = {
          statusline.enable = true;
          ai.enable = true;
          bufremove.enable = true;
          comment.enable = true;
          pairs.enable = true;
          cursorword.enable = true;
          icons.enable = true;
          move.enable = true;
          surround.enable = true;
          indentscope.enable = true;
          trailspace.enable = true;
        };

        # Utilities
        utility = {
          oil-nvim = {
            enable = true;
            gitStatus.enable = true;
            setupOpts = {
              view_options.show_hidden = true;
            };
          };
          sleuth.enable = true;
        };

        binds = {
          whichKey = {
            enable = true;
            register = {
              "<leader>f" = "+FZF";
              "<leader>l" = "+Language";
            };
          };
        };

        # Keymaps
        keymaps = [
          {
            key = "<leader>ff";
            mode = "n";
            action = "<Cmd>FzfLua files<CR>";
            desc = "[F]ind files";
          }
          {
            key = "<leader>fg";
            mode = "n";
            action = "<Cmd>FzfLua live_grep_native<CR>";
            desc = "Live [G]rep";
          }
          {
            key = "<leader><leader>";
            mode = "n";
            action = "<Cmd>FzfLua buffers<CR>";
            desc = "Buffers";
          }
          {
            key = "<leader>fh";
            mode = "n";
            action = "<Cmd>FzfLua help_tags<CR>";
            desc = "[H]elp Tags";
          }
          {
            key = "<leader>fx";
            mode = "n";
            action = "<Cmd>FzfLua diagnostics_document<CR>";
            desc = "Diagnostics Document";
          }
          {
            key = "<leader>fX";
            mode = "n";
            action = "<Cmd>FzfLua diagnostics_workspace<CR>";
            desc = "Diagnostics Workspace";
          }
          {
            key = "<leader>fs";
            mode = "n";
            action = "<Cmd>FzfLua lsp_document_symbols<CR>";
            desc = "Document [S]ymbols";
          }
          {
            key = "<leader>fS";
            mode = "n";
            action = "<Cmd>FzfLua lsp_workspace_symbols<CR>";
            desc = "Workspace [S]ymbols";
          }
          {
            key = "<leader>fk";
            mode = "n";
            action = "<Cmd>FzfLua keymaps<CR>";
            desc = "[K]eymaps";
          }
          {
            key = "<leader>fb";
            mode = "n";
            action = "<Cmd>FzfLua builtin<CR>";
            desc = "[B]uiltin FZF";
          }
          {
            key = "<leader>fr";
            mode = "n";
            action = "<Cmd>FzfLua resume<CR>";
            desc = "[R]esume";
          }
          {
            key = "<leader>fo";
            mode = "n";
            action = "<Cmd>FzfLua oldfiles<CR>";
            desc = "[O]ld Files";
          }
          {
            key = "<leader>-";
            mode = "n";
            action = "<Cmd>Oil --float<CR>";
            desc = "Open Current Directory";
          }
        ];
      };
    };
  };
}
